extends _layout

block title
  title 页面

block content
  pageName = 'settled-enterprises'

  include partials/_header.jade

  .container.page-container

  script(id="page", data-tmpl-html=".page-container", type='text/template').
    {{{content}}}

  include partials/_footer.jade

block append scripts
  :coffee
    matchs = location.search.match /(\?|&)id=(\d+)(&|$)/
    unless matchs and matchs[2]
      $tmpl 'page', content: '找不到该页面'
      return

    activeMenuItem = (pageId) ->
      $items = $ '.menu-list li > a'

      $items.filter (index) ->
        $item = $items.eq index
        matchs = $item.attr('href').match /\/?([^\/]+)$/
        return false unless matchs and matchs[1]
        matchs[1] is "page.html?id=#{pageId}"
      .addClass 'active'

    requester.get("/articles/pages/#{matchs[2]}").done (page) ->
      $('title').text page.name
      activeMenuItem page.id
      $tmpl 'page', page
    .fail ->
      $tmpl 'page', content: '请求数据失败'

